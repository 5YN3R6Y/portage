#!@BASH@
# Copyright 1999-2007 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Id: /var/cvsroot/gentoo-src/portage/bin/prepman,v 1.10.2.3 2005/05/29 12:40:08 jstubbs Exp $

if [[ -z $1 ]] ; then 
	mandir="${ED}usr/share/man"
else
	mandir="${ED}$1/man"
fi

if [[ ! -d ${mandir} ]] ; then
	eqawarn "QA Notice: prepman called with non-existent dir '${mandir#${ED}}'"
	exit 0
fi

shopt -s nullglob

ret=0

# compress and fixup links in each dir
for subdir in "${mandir}"/man* "${mandir}"/*/man* ; do
	[[ -d ${subdir} ]] || continue # ignore files named 'man*'
	ecompressdir "/${subdir#${ED}}"
	((ret+=$?))
done

exit ${ret}
