#!@BASH@
# Copyright 1999-2007 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Id: prepall 2230 2005-11-01 01:35:59Z vapier $

source "${PORTAGE_BIN_PATH:-@PORTAGE_BASE@/bin}"/isolated-functions.sh

if type -P chflags > /dev/null && type -P mtree > /dev/null ; then
	# Save all the file flags for restoration at the end of prepall.
	mtree -c -p "${ED}" -k flags > "${T}/bsdflags.mtree"
	# Remove all the file flags so that prepall can do anything necessary.
	chflags -R noschg,nouchg,nosappnd,nouappnd "${ED}"
	chflags -R nosunlnk,nouunlnk "${ED}" 2>/dev/null
fi

prepallman
prepallinfo

prepallstrip

if type -P chflags > /dev/null && type -P mtree > /dev/null; then
	# Restore all the file flags that were saved at the beginning of prepall.
	mtree -U -e -p "${ED}" -k flags < "${T}/bsdflags.mtree" &> /dev/null
fi
